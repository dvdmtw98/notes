---
title: Linked Libraries and Functions
tags:
  - security
  - malware
  - windows
  - programming
date: 2026-01-26 17:46:42 +0530
updated: 2026-01-27 21:57:06 +0530
---

#### Static Linking
Least commonly used method of linking libraries on Windows.  
Quite common in UNIX and Linux programs.  
All the code from the library is copied into the executable.  
This causes the executable to grow in size.  
Difficult to analyze as PE header does not include anything to differentiate between the executables code and statically linked code.  

#### Runtime Linking
Runtime linking is as a special case of dynamic linking.  
Unpopular in friendly files but commonly used by malware (especially when the program is obfuscated).  
The programs connect to the library code only when the function is needed (not at program start).  

Windows has a few function that allow libraries to be loaded without declaring then in the programs header.  
`LoadLibrary` and `GetProcAddress` are two of the most widely used functions for this purpose. However, `LdrGetProcAddress` and `LdrLoadDll` can also be used.  

> [!IMPORTANT] Native API
> - The functions that start with `Ldr` are part of the loader functions in Native API which is the low level abstraction that is used internally by the high-level Win32 API.  
> - Native API functions are undocumented and are not meant to be used by applications.  

These functions allow a program to load any function from any library on the system. Cannot statically figure out which function will be linked to the suspect program.

#### Dynamic Linking
The program fetches the library code that is required at program start.  
If the required libraries are not found the program will fail to execute.  
The libraries that are required are defined with import statements in the programs file header.  
Dynamic linking is slightly slower than static linking (because of library lookup).  

It is the most commonly used type of linking (even for malware).  
When a dynamically linked library function is called the function in the library is executed.  

**Dependency Walker** can be used to see the libraries that are dynamically loaded.  
The program can also show us what libraries are being imported and exported by the malware.  

Functions that are exported by the library are listed in the libraries export table.  
Function in this table also have a 16-bit identifier called an **ordinal**.  
It is a function is called by name the library locates its ordinal and uses it to find the function in the function address table.  
Functions can also be called directly using its ordinal (used by malware to make it difficult to identify which function is being used).  
Executables can also export functions but they are very rare.  

![[commonly-used-dlls.png|600]]

`Shell32.dll`: This DLL contains functions that are used to launch other programs.  

> [!IMPORTANT] Function Naming Convention
> - When Microsoft updates a function and it becomes incompatible with the previous function a new function with the same name and `Ex` (Extended) prefix is created.  
> - If the function is updated multiple times than a function with a different name is created or a numeric prefix is used to denote the new function.  
> - Functions that take string use the `W` and `A` suffix. They represent wide and ASCII respectively. The documentation will not list the functions with the suffix.  

`SetWindowsHookEx` is commonly used in spyware and is frequently used by keyloggers to capture keyboard inputs.  
